<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Exclusiva de Recursos - Kit Emprendedor</title>
    
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID"></script>
    
    <style>
        /* Estilos Generales y Colores */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000; /* Fondo negro */
            color: #ccc; /* Texto gris claro */
            transition: all 0.3s ease;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background-color: #1a1a1a; /* Fondo oscuro del contenedor */
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1); /* Sombra gris sutil */
        }

        h1 {
            color: #A9A9A9; /* Título color dorado/gris claro */
            text-align: center;
            margin-bottom: 20px; /* Reducido para hacer espacio al selector */
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        /* Contenedor del selector de moneda */
        .currency-selector-container {
            text-align: right;
            margin-bottom: 30px;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
        }

        .currency-selector-container label {
            font-size: 1.1em;
            margin-right: 10px;
            color: #fff;
        }

        .currency-selector-container select {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #A9A9A9;
            background-color: #222;
            color: #fff;
            font-size: 1em;
            cursor: pointer;
        }
        
        /* Grid de Productos */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .product-card {
            background-color: #222;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
            border: 1px solid #333;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.2);
        }

        .product-card h3 {
            color: #A9A9A9;
            margin-top: 10px;
            font-size: 1.5em;
        }

        .product-card p {
            font-size: 0.9em;
            color: #999;
            min-height: 40px;
        }

        .price {
            font-size: 1.8em;
            font-weight: bold;
            color: #fff;
            margin: 15px 0;
        }
        
        /* Botones de Selección */
        .variant-button {
            /* Estilo Base del Botón */
            background-color: #A9A9A9; /* Fondo color de realce para el CTA */
            color: #000;
            border: none;
            padding: 12px 20px;
            margin: 10px auto;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-size: 1.1em;
            font-weight: bold;
            
            /* Para centrar */
            display: flex; 
            align-items: center; 
            justify-content: center; 
            width: 90%; 
        }

        .variant-button:hover {
            background-color: #fff; /* Blanco al pasar el mouse */
            color: #000;
        }
        
        .variant-button.selected {
            background-color: #FFC439; /* Color de PayPal para indicar selección activa */
            color: #111;
            box-shadow: 0 0 10px #FFC439;
        }

        /* Estilo del texto de PayPal dentro del botón */
        .variant-button .paypal-text {
            color: #003087; /* Azul de PayPal */
            font-weight: 800;
            margin-left: 5px;
        }

        /* Contenedor Flotante de Compra */
        #floating-cart {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background-color: #222;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.4);
            z-index: 1000;
            display: none; /* Oculto por defecto */
            border: 2px solid #A9A9A9;
        }

        #floating-cart h3 {
            color: #A9A9A9;
            margin-top: 0;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        #floating-cart p {
            margin: 5px 0;
            color: #ccc;
        }

        #floating-cart strong {
            color: #fff;
        }

        /* Estilo para el contenedor de PayPal dentro del flotante */
        #paypal-button-container {
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Selecciona la Versión de Tu Kit de Emprendimiento</h1>

        <div class="currency-selector-container">
            <label for="currency-select">Seleccionar Moneda:</label>
            <select id="currency-select" onchange="updateCurrencyDisplay()">
                <option value="USD" selected>Dólar Estadounidense (USD - $)</option>
                <option value="EUR">Euro (EUR - €)</option>
            </select>
        </div>
        <div class="product-grid">

            <div class="product-card">
                <h3>Kit Digital Básico</h3>
                <p>Acceso a la guía principal y plantillas esenciales. Ideal para principiantes.</p>
                <div class="price" data-usd-price="19.99">$19.99 USD</div> 
                <button 
                    class="variant-button" 
                    data-id="1" 
                    data-title="Kit Digital Básico" 
                    data-price="19.99"
                    onclick="selectProduct(this)">
                    Comprar Ahora 
                    <span class="paypal-text">| PayPal</span>
                </button>
            </div>

            <div class="product-card">
                <h3>Kit Digital Premium</h3>
                <p>Incluye guía avanzada, 1 hora de consultoría y recursos exclusivos. ¡El más popular!</p>
                <div class="price" data-usd-price="49.99">$49.99 USD</div>
                <button 
                    class="variant-button" 
                    data-id="2" 
                    data-title="Kit Digital Premium" 
                    data-price="49.99"
                    onclick="selectProduct(this)">
                    Comprar Ahora 
                    <span class="paypal-text">| PayPal</span>
                </button>
            </div>

            <div class="product-card">
                <h3>Kit Mentor Master</h3>
                <p>Todo lo anterior más un mes de soporte ilimitado y plan de negocio personalizado.</p>
                <div class="price" data-usd-price="99.99">$99.99 USD</div>
                <button 
                    class="variant-button" 
                    data-id="3" 
                    data-title="Kit Mentor Master" 
                    data-price="99.99"
                    onclick="selectProduct(this)">
                    Comprar Ahora 
                    <span class="paypal-text">| PayPal</span>
                </button>
            </div>

        </div>
    </div>

    <div id="floating-cart">
        <h3>Tu Compra Rápida</h3>
        <p>Producto: <strong id="cart-title">Ninguno</strong></p>
        <p>Total: <strong id="cart-price">$0.00 USD</strong></p> 
        
        <div id="paypal-button-container"></div>
        
        <p style="font-size: 0.8em; text-align: center; color: #888; margin-top: 10px;">
            El pago es 100% seguro y gestionado por PayPal.
        </p>
    </div>

    <script>
        let selectedProduct = null;
        let currentCurrency = 'USD'; // Moneda inicial
        
        // ** Tasa de Conversión Fija para el ejemplo (USD por EUR) **
        // En un entorno de producción, DEBERÍAS obtener esto de una API de divisas.
        const conversionRate = {
            'USD': 1.00,
            'EUR': 0.9259 // Ejemplo: 1 EUR = 0.9259 USD (o 1 USD = 1.08 EUR)
        };
        const currencySymbols = {
            'USD': '$',
            'EUR': '€'
        };

        const floatingCart = document.getElementById('floating-cart');
        const cartTitle = document.getElementById('cart-title');
        const cartPrice = document.getElementById('cart-price');
        const currencySelect = document.getElementById('currency-select');
        
        /**
         * Calcula el precio en la moneda actual.
         * @param {number} usdPrice - Precio base en USD.
         * @returns {number} El precio convertido.
         */
        function convertPrice(usdPrice) {
            // El precio base (data-price) está en USD.
            // Si la moneda actual es USD, se usa el precio base.
            // Si es EUR, se divide el precio base por la tasa de cambio USD/EUR (ej: 1.08)
            // o se multiplica por la tasa EUR/USD (ej: 0.9259).
            
            // Usando la tasa inversa (USD/EUR) de 1.08, que es 1/0.9259
            if (currentCurrency === 'EUR') {
                // Si 1 USD = 0.9259 EUR, entonces Price_EUR = Price_USD * 0.9259
                return usdPrice * conversionRate['EUR'];
            }
            return usdPrice; // Si es USD
        }

        /**
         * Formatea el precio con el símbolo y código de moneda actual.
         * @param {number} price - El valor numérico del precio.
         * @returns {string} El precio formateado.
         */
        function formatPrice(price) {
            const symbol = currencySymbols[currentCurrency];
            return `${symbol}${price.toFixed(2)} ${currentCurrency}`;
        }
        
        /**
         * Actualiza la visualización de todos los precios en la página.
         */
        function updateCurrencyDisplay() {
            currentCurrency = currencySelect.value;
            const priceElements = document.querySelectorAll('.price');
            
            priceElements.forEach(el => {
                const usdPrice = parseFloat(el.getAttribute('data-usd-price'));
                const newPrice = convertPrice(usdPrice);
                el.textContent = formatPrice(newPrice);
            });
            
            // Si hay un producto seleccionado, actualiza el carrito flotante y PayPal
            if (selectedProduct) {
                // Recalcular el precio del producto seleccionado en la nueva moneda
                const newPrice = convertPrice(selectedProduct.basePrice); 
                selectedProduct.currentPrice = newPrice;
                
                // Actualizar el carrito flotante
                cartPrice.textContent = formatPrice(newPrice);
                floatingCart.style.display = 'block';

                // Inicializar/Reinicializar los botones de PayPal con la nueva moneda y precio
                initPayPalButtons(selectedProduct.id, selectedProduct.currentPrice, selectedProduct.title, currentCurrency);
            }
        }
        
        /**
         * Maneja la selección de un producto y actualiza el carrito flotante.
         */
        function selectProduct(buttonElement) {
            const id = buttonElement.getAttribute('data-id');
            const title = buttonElement.getAttribute('data-title');
            const basePrice = parseFloat(buttonElement.getAttribute('data-price')); // Siempre USD
            
            const currentPrice = convertPrice(basePrice);

            selectedProduct = { id, title, basePrice, currentPrice };

            // 1. Marcar el botón como seleccionado
            document.querySelectorAll('.variant-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            buttonElement.classList.add('selected');
            
            // 2. Actualizar el carrito flotante
            cartTitle.textContent = title;
            cartPrice.textContent = formatPrice(currentPrice);
            floatingCart.style.display = 'block';

            // 3. Inicializar/Reinicializar los botones de PayPal con el nuevo producto
            initPayPalButtons(id, currentPrice, title, currentCurrency);
        }

        /**
         * Inicializa los Smart Buttons de PayPal.
         */
        function initPayPalButtons(id, price, title, currency) {
            // Limpia el contenedor anterior para evitar duplicados
            const paypalContainer = document.getElementById('paypal-button-container');
            if (paypalContainer) {
                paypalContainer.innerHTML = '';
            }
            
            // Verifica que el SDK esté cargado
            if (typeof paypal === 'undefined') {
                console.error("PayPal SDK no cargado. Revisa tu Client ID.");
                return;
            }

            paypal.Buttons({
                style: {
                    layout: 'vertical',
                    color: 'gold', 
                    shape: 'rect',
                    label: 'paypal'
                },
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                // CRÍTICO: Usar el precio y la moneda convertida
                                value: price.toFixed(2), 
                                currency_code: currency 
                            },
                            description: `Compra: ${title} (ID: ${id})`
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        const finalAmount = details.purchase_units[0].amount.value;
                        const finalCurrency = details.purchase_units[0].amount.currency_code;
                        alert(`¡Pago de ${finalAmount} ${finalCurrency} completado para "${title}"!\n\nID de Transacción: ${details.id}`);
                        
                        // *** PASO CRÍTICO DE BACKEND AQUÍ ***
                        // Envía details.id, id del producto, y el currency_code a tu servidor.
                        
                        floatingCart.style.display = 'none';
                        document.querySelectorAll('.variant-button').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        selectedProduct = null;
                    });
                },
                onError: function(err) {
                    console.error('Error de PayPal:', err);
                    alert('Hubo un error con el pago. Por favor, inténtalo de nuevo.');
                }
            }).render('#paypal-button-container');
        }

        // Llamar a la función al cargar para asegurar que los precios iniciales usen USD
        // y para inicializar la variable currentCurrency correctamente.
        document.addEventListener('DOMContentLoaded', updateCurrencyDisplay);
    </script>
</body>
</html>